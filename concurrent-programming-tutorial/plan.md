## 并发编程学习计划（面向 Java 开发）

节奏：6 周，每周 5~8 小时。每周包含「概念 → 实验 → 复盘 → 扩展」，确保能写出代码、看到现象、给出解释。遇到难点优先写对照实验，用 Codex 做日志/栈轨迹/思路辅助，但关键实现与调试由你亲自完成。

### Week 1：并发动机与基础模型
- 目标：理解并发 vs 并行、线程生命周期、上下文切换成本。
- 理论：线程/进程区别，线程状态，内核/用户态切换，CPU 缓存层次简介。
- 实践：用 `Thread`/`Runnable` 启动多个线程打印标识；在循环中统计上下文切换/时间开销；写一个错误的共享变量示例观察错乱输出。
- 输出：一份「为什么需要并发」短文 + 演示上下文切换成本的代码与测量结果。

### Week 2：可见性与原子性（JMM）
- 目标：理解 Java Memory Model、happens-before 规则。
- 理论：主内存/工作内存、指令重排、`volatile` 语义、`final` 安全发布。
- 实践：实现一个停止标志示例（不加 `volatile` 的卡死 vs 加后的正确性）；写自增竞态示例与修复（`AtomicInteger`/`synchronized`）。
- 输出：对比实验的代码与日志，JMM 关键规则的口述笔记。

### Week 3：互斥与锁
- 目标：掌握内置锁与显式锁，理解锁升级/偏向/自旋的意义。
- 理论：`synchronized` 语义，`ReentrantLock`、`Condition`，锁的可重入/公平性，死锁/活锁/饥饿。
- 实践：实现银行转账并演示死锁，再用排序加锁/尝试锁避免；使用 `ReentrantLock` + `Condition` 实现有界阻塞队列。
- 输出：死锁复现与解决方案说明，阻塞队列实现及测试。

### Week 4：线程协作与任务模型
- 目标：熟练使用线程池与任务调度。
- 理论：`ExecutorService`/`ThreadPoolExecutor` 参数，拒绝策略，`Future`/`Callable`，`CompletionService`，分治与 Fork/Join。
- 实践：定制线程池（命名线程、捕获异常、埋点）；用 `CompletionService` 实现并行抓取/聚合；写一个 Fork/Join 计算示例。
- 输出：线程池参数调优经验记录，示例代码与基准数据。

### Week 5：无锁与并发容器
- 目标：理解无锁/有锁实现差异，掌握常用并发容器。
- 理论：CAS、ABA、`Atomic` 系列，`LongAdder`，`ConcurrentHashMap` 原理，伪共享与 False Sharing 缓解。
- 实践：对比 `AtomicInteger` 与 `LongAdder` 的高并发吞吐；实现一个基于 CAS 的简易栈/队列；用 `ConcurrentHashMap` 做本地缓存（含过期与统计）。
- 输出：性能对比表，简易无锁结构代码，缓存实现与测试。

### Week 6：正确性、性能与工程化
- 目标：会验证并发正确性并做性能调优。
- 理论：并发测试策略（压力测试、`jcstress` 概念）、`ThreadLocal` 使用与泄漏风险，`CompletableFuture` 组合模式，调优方法论。
- 实践：为前几周的组件写并发压力测试（可用 JMH 基准）；用 `CompletableFuture` 编排 3 个异步任务并加超时/降级；用 `jstack`/`jcmd`/`jvisualvm` 观测线程状态与阻塞点。
- 输出：测试脚本与基准数据，线程 dump 分析记录，`CompletableFuture` 组合示例。

### 每周节奏建议
- 周初：阅读理论 + 列出要验证的现象。
- 周中：编码实验（先写错误/对照版本，再写正确/优化版本）。
- 周末：复盘（记录现象、原因、修正、心得），整理到仓库。
- 贯穿：对每个实验至少保留一份「错误日志 vs 修复后日志」对比。

### 练习提示
- 先写最小可复现实验，再逐步引入工具类；保持日志简洁，打印线程名、时间与关键状态。
- 出现疑难 bug 时，用 Codex 询问「假设」「排查思路」「验证步骤」，再亲自执行与验证。
- 每个示例都写一个简单的对照测试（哪怕是 JUnit 的并发 smoke test）以防回归。

### 里程碑检查表
- W2 结束：能解释 happens-before；能用 `volatile` 解决可见性问题。
- W3 结束：能复现并消除死锁；能实现有界阻塞队列并通过并发测试。
- W4 结束：能根据任务特征配置线程池并解释参数取舍。
- W5 结束：能对比有锁/无锁吞吐差异；会选用合适的并发容器。
- W6 结束：能基于基准/线程 dump 定位瓶颈；能编排异步任务并处理异常与超时。

### 额外扩展（可选）
- 研究 Disruptor/RingBuffer 模型、队列选择与背压。
- 探索 Reactor/Project Loom（虚拟线程）对代码结构与性能的影响。
- 编写一份团队级并发编码规范与代码审查检查单。
